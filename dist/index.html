<!DOCTYPE html>
<html lan="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Push Notification Demo</title>
    <meta name="apple-mobile-web-app-status-bar" content="#EA3D58">
    <meta name="theme-color" content="#EA3D58">
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/@material/theme@9.0.0/dist/mdc.theme.min.css">

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="./main.css">
    
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    

    
    <!-- Manifest File link -->
    <link rel="manifest" href="manifest.json">
   </head>
<body>
    <header class="mdc-top-app-bar" id="top-bar">
        <div class="mdc-top-app-bar__row">
          <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
            <img class="mdc-top-app-bar__navigation-icon" src="images/icon512_512.png" alt="My Logo" width="50">
            <span class="mdc-top-app-bar__title">PWA Notification</span>
          </section>
          <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
            <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" title="help">help</button>
            <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" title="Share" onclick="openShareBox()">share</button>

          </section>
        </div>
      </header>
      <main class="mdc-top-app-bar--fixed-adjust">
        <div class="mdc-banner" role="banner">
            <div class="mdc-banner__content"
                 role="alertdialog"
                 aria-live="assertive">
              <div class="mdc-banner__graphic-text-wrapper">
                <div class="mdc-banner__text">
                  There was a problem processing a transaction on your credit card.
                </div>
              </div>
              <div class="mdc-banner__actions">
                <button type="button" class="mdc-button mdc-banner__secondary-action">
                  <div class="mdc-button__ripple"></div>
                  <div class="mdc-button__label">Learn more</div>
                </button>
                <button type="button" class="mdc-button mdc-banner__primary-action">
                  <div class="mdc-button__ripple"></div>
                  <div class="mdc-button__label">Fix it</div>
                </button>
              </div>
            </div>
          </div>

          <button class="mdc-fab mdc-fab--extended"  onClick="askPermission()" id="pushRequest" style="display: none;">
            <div class="mdc-fab__ripple"></div>
            <span class="material-icons mdc-fab__icon">add_alert</span>
            <span class="mdc-fab__label">Receive Notificatins</span>
          </button>
          <!-- Code Copy Popup Start-->
          <div class="mdc-dialog">
            <div class="mdc-dialog__container">
              <div class="mdc-dialog__surface"
                role="alertdialog"
                aria-modal="true"
                aria-labelledby="my-dialog-title"
                aria-describedby="my-dialog-content">
                <div class="mdc-dialog__content" id="my-dialog-content">
                  Copy Notification Token
                  <textArea id="notficationCode" readonly>
                  </textarea>
                </div>
                <div class="mdc-dialog__actions">
                  <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="cancel">
                    <div class="mdc-button__ripple"></div>
                    <span class="mdc-button__label">Cancel</span>
                  </button>
                  <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="copy">
                    <div class="mdc-button__ripple"></div>
                    <span class="mdc-button__label">Copy</span>
                  </button>
                </div>
              </div>
            </div>
            <div class="mdc-dialog__scrim"></div>
          </div>
          <!-- code copy popup end-->

          <!-- body -->
          <br/>
          <br/>
          <div class="button-container-div">
            <button class="mdc-fab mdc-fab--extended"  onclick="sendNotfication('meme',0)">
                <div class="mdc-fab__ripple"></div>
                <span class="material-icons mdc-fab__icon">add_alert</span>
                <span class="mdc-fab__label">Push a Meme Now</span>
              </button>
              <button class="mdc-fab mdc-fab--extended"  onclick="sendNotfication('meme',5000)" >
                <div class="mdc-fab__ripple"></div>
                <span class="material-icons mdc-fab__icon">timer</span>
                <span class="mdc-fab__label">push a meme (5 Sec)</span>
              </button>
              <button class="mdc-fab mdc-fab--extended" onclick="sendNotfication('meme',0)">
                <div class="mdc-fab__ripple"></div>
                <span class="material-icons mdc-fab__icon">add_alert</span>
                <span class="mdc-fab__label">Assign Order Now</span>
              </button>
              <button class="mdc-fab mdc-fab--extended" onclick="sendNotfication('order',5000)">
                <div class="mdc-fab__ripple"></div>
                <span class="material-icons mdc-fab__icon">timer</span>
                <span class="mdc-fab__label">Assign Order (5 Sec)</span>
              </button>
              

          <aside class="mdc-snackbar">
            <div class="mdc-snackbar__surface" role="status" aria-relevant="additions">
              <div class="mdc-snackbar__label" aria-atomic="false">
                Can't send photo. Retry in 5 seconds.
              </div>
              <div class="mdc-snackbar__actions" aria-atomic="true">
                <button type="button" class="mdc-button mdc-snackbar__action">
                  <div class="mdc-button__ripple"></div>
                  <span class="mdc-button__label">Dismiss</span>
                </button>
              </div>
            </div>
          </aside>
          

            <!-- body -->
     
      </main>


</body>
<script type="module" src="/bundle.js"></script>
<script>
const MDCBanner = mdc.banner.MDCBanner;
const banner = new MDCBanner(document.querySelector('.mdc-banner'));
const dialog = new mdc.dialog.MDCDialog(document.querySelector('.mdc-dialog'));




//banner.open()
window.addEventListener('load', () => {
    

    if(Notification.permission != "granted"){
        document.getElementById("pushRequest").style.display = "";
    }else{
        requestPermission().then(data => {
            document.getElementById("notficationCode").value = data;
        });
        
    }
});



function sendNotfication(type, timeout){

  let data = {token:  document.getElementById("notficationCode").value ,type:type,delay:timeout};
  fetch("https://firebasepushtest.azurewebsites.net/", {
    method: "POST",
    headers: {'Content-Type': 'application/json'}, 
    body: JSON.stringify(data)
  }).then(res => {
    console.log("Request complete!, response:", res);
  });
}


dialog.listen('MDCDialog:closed', (event) => {
  const action = event.detail.action;
  if (action === 'copy') {
    // Handle delete action
    navigator.clipboard.writeText(document.getElementById("notficationCode").value )
    
  } else if (action === 'cancel') {
    // Handle cancel action
  }
});

function openShareBox(){

    dialog.open()
}


function askPermission(){
    requestPermission().then(data => {
            if(data){
                document.getElementById("pushRequest").style.display = "none";
                document.getElementById("notficationCode").value = data;
                
            }else{
                alert('Access Denied');
            }
      
        });
}

</script>
</html>